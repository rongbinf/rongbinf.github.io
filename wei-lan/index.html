<!DOCTYPE html>

<html lang="en"  dir="ltr"

>

<head>
  <title class="p-name">Wei Lan Library 微澜图书馆 - Rongbin&#39;s Blog</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="description"
    content="
What&rsquo;s the background?
#


There are an estimated 292.51 million rural migrant workers
    
        Source: National Bureau of Statistics, 2021
        
    
 in China&rsquo;s cities as delivery motorbike-riders, labourers, doorkeepers and other jobs that urbanites avoid.
The children of this floating population are called floating children or migrant children.
The families, holding a rural Hukou
    
        Hukou, China&rsquo;s household registration system, which divides the population into two different statuses: agricultural and non-agricultural residency statuses. Yet China provides a wide range of public education, resources in cities, which means only city hukou holders could benefit from, are exceedingly more than schools in rural.
        
    
 and on a tight budget, could only afford low-cost private schools which barely have good education resources, even books.
The organisation is aimed at helping these children.


How?
#


Though some of these schools do receive donations, the lack of teachers and librarians hinders the daily operation of the school library.
Here, volunteers from Wei Lan Library take the responsibility by spending one or two days a week, sorting books, helping kids find good ones and maintaining a rather safe environment to study.
They step even further: conduct both quantitative and qualitative research, reach out to publishing houses and enterprises about possibilities to donate, work with press and media, speak out at forums and conferences and so forth.


I&rsquo;m interested in it! Can I help or donate?
#


Yes! If you are based in China, you are very welcome to be a volunteer on-site to help with the daily operation - this is the key and the heart of the project.
If you&rsquo;d like to support public communication, promotion, information disclosure, or anything you can think of and are willing to do, you can always find a place here.
You can make a one-time donation, join our monthly donation programme (馆东计划), purchase charity goods, or donate books and equipment.

If you are familiar with WeChat, follow our WeChat and click 支持微澜 → 捐赠 to make a donation directly. I have also created an account on Buy Me a Coffee, and 100% of the proceeds go to Wei Lan.
If you are working for a press or have some second-hand books to donate, shoot me email to discuss details!


Read more about the project on our official WeChat account and official website (Simplified Chinese). Drop me a message if you don&rsquo;t speak Chinese, and I&rsquo;m more than happy to help you learn more about Wei Lan and also the recruitment process.


Media Coverage in English
#


China Development Brief: Part I, Part II
China Daily, Library project a novel experience for migrant children
 ">
<meta name="author p-author" content="Rongbin FAN" href="https://fanrongbin.com">

<meta property="og:title" content='Wei Lan Library 微澜图书馆 - Rongbin&#39;s Blog' />
<meta property="og:description" content="
What&rsquo;s the background?
#


There are an estimated 292.51 million rural migrant workers
    
        Source: National Bureau of Statistics, 2021
        
    
 in China&rsquo;s cities as delivery motorbike-riders, labourers, doorkeepers and other jobs that urbanites avoid.
The children of this floating population are called floating children or migrant children.
The families, holding a rural Hukou
    
        Hukou, China&rsquo;s household registration system, which divides the population into two different statuses: agricultural and non-agricultural residency statuses. Yet China provides a wide range of public education, resources in cities, which means only city hukou holders could benefit from, are exceedingly more than schools in rural.
        
    
 and on a tight budget, could only afford low-cost private schools which barely have good education resources, even books.
The organisation is aimed at helping these children.


How?
#


Though some of these schools do receive donations, the lack of teachers and librarians hinders the daily operation of the school library.
Here, volunteers from Wei Lan Library take the responsibility by spending one or two days a week, sorting books, helping kids find good ones and maintaining a rather safe environment to study.
They step even further: conduct both quantitative and qualitative research, reach out to publishing houses and enterprises about possibilities to donate, work with press and media, speak out at forums and conferences and so forth.


I&rsquo;m interested in it! Can I help or donate?
#


Yes! If you are based in China, you are very welcome to be a volunteer on-site to help with the daily operation - this is the key and the heart of the project.
If you&rsquo;d like to support public communication, promotion, information disclosure, or anything you can think of and are willing to do, you can always find a place here.
You can make a one-time donation, join our monthly donation programme (馆东计划), purchase charity goods, or donate books and equipment.

If you are familiar with WeChat, follow our WeChat and click 支持微澜 → 捐赠 to make a donation directly. I have also created an account on Buy Me a Coffee, and 100% of the proceeds go to Wei Lan.
If you are working for a press or have some second-hand books to donate, shoot me email to discuss details!


Read more about the project on our official WeChat account and official website (Simplified Chinese). Drop me a message if you don&rsquo;t speak Chinese, and I&rsquo;m more than happy to help you learn more about Wei Lan and also the recruitment process.


Media Coverage in English
#


China Development Brief: Part I, Part II
China Daily, Library project a novel experience for migrant children
 " />
<meta property="og:url" content="https://fanrongbin.com/wei-lan/" />
<meta property="og:image" content="https://fanrongbin.com/apple-touch-icon.png" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://fanrongbin.com/apple-touch-icon.png" />
<meta name="twitter:title" content='Wei Lan Library 微澜图书馆 - Rongbin&#39;s Blog' />
<meta name="twitter:description" content="
What&rsquo;s the background?
#


There are an estimated 292.51 million rural migrant workers
    
        Source: National Bureau of Statistics, 2021
        
    
 in China&rsquo;s cities as delivery motorbike-riders, labourers, doorkeepers and other jobs that urbanites avoid.
The children of this floating population are called floating children or migrant children.
The families, holding a rural Hukou
    
        Hukou, China&rsquo;s household registration system, which divides the population into two different statuses: agricultural and non-agricultural residency statuses. Yet China provides a wide range of public education, resources in cities, which means only city hukou holders could benefit from, are exceedingly more than schools in rural.
        
    
 and on a tight budget, could only afford low-cost private schools which barely have good education resources, even books.
The organisation is aimed at helping these children.


How?
#


Though some of these schools do receive donations, the lack of teachers and librarians hinders the daily operation of the school library.
Here, volunteers from Wei Lan Library take the responsibility by spending one or two days a week, sorting books, helping kids find good ones and maintaining a rather safe environment to study.
They step even further: conduct both quantitative and qualitative research, reach out to publishing houses and enterprises about possibilities to donate, work with press and media, speak out at forums and conferences and so forth.


I&rsquo;m interested in it! Can I help or donate?
#


Yes! If you are based in China, you are very welcome to be a volunteer on-site to help with the daily operation - this is the key and the heart of the project.
If you&rsquo;d like to support public communication, promotion, information disclosure, or anything you can think of and are willing to do, you can always find a place here.
You can make a one-time donation, join our monthly donation programme (馆东计划), purchase charity goods, or donate books and equipment.

If you are familiar with WeChat, follow our WeChat and click 支持微澜 → 捐赠 to make a donation directly. I have also created an account on Buy Me a Coffee, and 100% of the proceeds go to Wei Lan.
If you are working for a press or have some second-hand books to donate, shoot me email to discuss details!


Read more about the project on our official WeChat account and official website (Simplified Chinese). Drop me a message if you don&rsquo;t speak Chinese, and I&rsquo;m more than happy to help you learn more about Wei Lan and also the recruitment process.


Media Coverage in English
#


China Development Brief: Part I, Part II
China Daily, Library project a novel experience for migrant children
 " />

<link rel="canonical" href="https://fanrongbin.com/wei-lan/" />






      <link rel="stylesheet" href="/css/main.min.ace4cec8417d209e56f17f2a41179ee2229d41357cfecffb2139c21062843cfe.css" integrity="sha256-rOTOyEF9IJ5W8X8qQRee4iKdQTV8/s/7ITnCEGKEPP4=" crossorigin="anonymous">

<link rel="stylesheet" href="/han.min.css" type="text/css">





<link rel="alternate" type="application/activity+json" href="https://fed.brid.gy/r/https://fanrongbin.com/wei-lan/">

<link rel="webmention" href="https://webmention.io/fanrongbin.com/webmention" />

<script data-goatcounter="https://ron.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>

<body class="han-init-context">

  <section class="navbar">
    <span class="header-name">
    <a href="/" class="header-link h-card p-name p-author u-url u-uid">Rongbin FAN</a>
     / <a href="/posts" class="header-link">Blog</a>
    <br>
    <a href="/stream" class="header-link header-guestbook">ϟ Stream</a>
    
    <a href="/links" class="header-link header-guestbook">◩ Guestbook</a>
    
</span>


  </section>

  <article class="article-entry h-entry">
      

<section class="content-header">

  <div class="top-scroll-bar"></div>
<div class="addn visible">
<a onclick="showHypo()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="show-hypo" class="header-button no-select">Hypothes.is</div></a>
<a onclick="toggleTOC()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="contents-fixed" class="header-button no-select">Contents</div></a>
</div>
<div id="contents-toc" class="no-select">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#whats-the-background">What&rsquo;s the background?</a></li>
    <li><a href="#how">How?</a></li>
    <li><a href="#im-interested-in-it-can-i-help-or-donate">I&rsquo;m interested in it! Can I help or donate?</a></li>
    <li><a href="#media-coverage-in-english">Media Coverage in English</a></li>
  </ul>
</nav>
</div>

  

  <div id="single-header">
    <h1 class="p-name content-h1">Wei Lan Library 微澜图书馆</h1><p class="subtitle">Wei Lan (WaveLib, Weilan) Library is a real, non-government, non-profit organisation aimed at building libraries for floating children in China.</p>
    

    
      
      
      
        
      
    

    <a rel="author" class="p-name h-card" href="https://fanrongbin.com" style="display:none;">Rongbin Fan</a>
  </div>

  

</section>





<style>
  .navbar, footer, .footer-nav, .webmentions-how, .comment-box, .comment-title {
    opacity: 0.35 !important;
  }
  .navbar:hover, footer:hover, .footer-nav:hover, .webmentions-how:hover, .comment-box:hover {
    opacity: 1 !important;
  }
</style>



<div class="link-display"></div>


      
      
      
      <main class="e-content">
      
      














    

    

    

    

<h2 id="whats-the-background">
What&rsquo;s the background?
<a href="#whats-the-background" class="heading-anchor">#</a>
</h2>
<ul>
<li>There are an estimated 292.51 million rural migrant workers<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">Source: National Bureau of Statistics, 2021</small>
        <span class="sidenote-line"></span>
    </span>
</span> in China&rsquo;s cities as delivery motorbike-riders, labourers, doorkeepers and other jobs that urbanites avoid.</li>
<li>The children of this floating population are called <a href="https://www.nytimes.com/2006/09/08/opinion/08iht-edang.2741938.html"><em>floating children</em></a> or <em>migrant children</em>.</li>
<li>The families, holding a rural <a href="https://en.wikipedia.org/wiki/Hukou"><em>Hukou</em></a><span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote"><em>Hukou</em>, China&rsquo;s household registration system, which divides the population into two different statuses: agricultural and non-agricultural residency statuses. Yet China provides a wide range of public education, resources in cities, which means only city hukou holders could benefit from, are exceedingly more than schools in rural.</small>
        <span class="sidenote-line"></span>
    </span>
</span> and on a tight budget, could only afford low-cost private schools which barely have good education resources, even books.</li>
<li>The organisation is aimed at helping these children.</li>
</ul>
<h2 id="how">
How?
<a href="#how" class="heading-anchor">#</a>
</h2>
<ul>
<li>Though some of these schools do receive donations, the lack of teachers and librarians hinders the daily operation of the school library.</li>
<li>Here, volunteers from Wei Lan Library take the responsibility by spending one or two days a week, sorting books, helping kids find good ones and maintaining a rather safe environment to study.</li>
<li>They step even further: conduct both quantitative and qualitative research, reach out to publishing houses and enterprises about possibilities to donate, work with press and media, speak out at forums and conferences and so forth.</li>
</ul>
<h2 id="im-interested-in-it-can-i-help-or-donate">
I&rsquo;m interested in it! Can I help or donate?
<a href="#im-interested-in-it-can-i-help-or-donate" class="heading-anchor">#</a>
</h2>
<ul>
<li>Yes! If you are based in China, you are very welcome to be a volunteer on-site to help with the daily operation - this is the key and the heart of the project.</li>
<li>If you&rsquo;d like to support public communication, promotion, information disclosure, or anything you can think of and are willing to do, you can always find a place here.</li>
<li>You can make a one-time donation, join our monthly donation programme (馆东计划), purchase charity goods, or donate books and equipment.
<ul>
<li>If you are familiar with WeChat, follow our WeChat and click <code>支持微澜 → 捐赠</code> to make a donation directly. I have also created an account on <a href="https://www.buymeacoffee.com/rongbin">Buy Me a Coffee</a>, and 100% of the proceeds go to Wei Lan.</li>
<li>If you are working for a press or have some second-hand books to donate, <a href="mailto:hi@fanrongbin.com?subject=Book%20Donation%20to%20Wei%20Lan%20Library">shoot me email</a> to discuss details!</li>
</ul>
</li>
<li>Read more about the project on our <a href="https://mp.weixin.qq.com/s/_Dcztsm71l-4XW3bZPt_XQ">official WeChat account</a> and <a href="http://www.sanzhi.org.cn">official website</a> (Simplified Chinese). <a href="https://fanrongbin.com/contact">Drop me a message</a> if you don&rsquo;t speak Chinese, and I&rsquo;m more than happy to help you learn more about Wei Lan and also the recruitment process.</li>
</ul>
<h2 id="media-coverage-in-english">
Media Coverage in English
<a href="#media-coverage-in-english" class="heading-anchor">#</a>
</h2>
<ul>
<li>China Development Brief: <a href="https://chinadevelopmentbrief.org/reports/wei-lan-library-getting-migrant-children-reading-part-1/">Part I</a>, <a href="https://chinadevelopmentbrief.org/reports/wei-lan-library-getting-migrant-children-reading-part-ii/">Part II</a></li>
<li>China Daily, <a href="https://global.chinadaily.com.cn/a/202306/23/WS6494d136a310bf8a75d6b3bb.html"><em>Library project a novel experience for migrant children</em></a></li>
</ul>



          
      
          <a class="u-url" href="https://fanrongbin.com/wei-lan/" hidden="from-humans" style="display:none;"></a>
      

      </main>
      
      
      <a class="u-bridgy-fed" rel="bridgy" href="https://fed.brid.gy/" hidden="from-humans" style="display:none;"></a>

  
  </article>
  

  

  <footer class="opacity-6">
    <p><a href="/colophon">Colophon</a></p><p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a></p>
  </footer>

</body>

<script src="/han.min.js" defer></script>



<script type="application/json" class="js-hypothesis-config" defer>
{
    "sideBySide": {
        "mode": "manual"
    }
}
</script>

<script defer>
    var mainElement = document.querySelector('main');
    var contentHeader = document.querySelector('section.content-header');
    const headers = mainElement.querySelectorAll('h2, h3');
    document.addEventListener('DOMContentLoaded', function () {

        if (contentHeader) {
            contentHeader.querySelector('#show-hypo').style.display = 'flex';
        }

        handleScrollEvents();

        applyBreakAllClass();

        setupSidenotes();

        initializeMutationObserver();

        initializeTOCFeatures();

        preventMultiTouchGestures();

        setExternalLinksToOpenInNewTab();
    });

    function updateHHangableBehavior() {
        var sidenoteHangables = mainElement.querySelectorAll('.sidenote-number + h-hangable');
        sidenoteHangables.forEach(function (hHangable) {
            var sidenoteNumber = hHangable.previousElementSibling;
            var sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
            if (sidenoteBox) {
                sidenoteNumber.insertBefore(hHangable, sidenoteBox);
            }
        });
    }

    function initializeMutationObserver() {
        var observer = new MutationObserver(function (mutations) {
            var shouldUpdate = false;
            mutations.forEach(function (mutation) {
                mutation.addedNodes.forEach(function (node) {
                    if (node.nodeType === 1 && node.matches('h-hangable')) {
                        var previousSibling = node.previousElementSibling;
                        if (previousSibling && previousSibling.matches('.sidenote-number')) {
                            shouldUpdate = true;
                        }
                    }
                });
            });
            if (shouldUpdate) {
                setTimeout(updateHHangableBehavior, 1200);
            }
        });

        var config = { childList: true, subtree: true };
        if (mainElement) {
            observer.observe(mainElement, config);
        }
    }

    function applyBreakAllClass() {
        var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var codeElements = mainElement.querySelectorAll('code');

        codeElements.forEach(function (element) {
            if (screenWidth <= 960) {
                if (element.textContent.length > 10) {
                    element.classList.add('break-all');
                }
            }
            else {
                if (element.textContent.length > 30) {
                    element.classList.add('break-all');
                }
            }
        });
    }

    function handleScrollEvents() {
        if (contentHeader) {
            let lastScrollTop = 0;
            let isScrolling = false;
            const addnDiv = contentHeader.querySelector('.addn');
            const topScrollBar = contentHeader.querySelector('.top-scroll-bar');

            window.addEventListener('scroll', function () {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (!isScrolling) {
                    window.requestAnimationFrame(function () {
                        if (topScrollBar) {
                            const scrollPercent = (currentScroll / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                            topScrollBar.style.width = scrollPercent + '%';
                            topScrollBar.style.display = 'block';
                        }
                        if (addnDiv) {
                            if (currentScroll > lastScrollTop && currentScroll > 50) {
                                addnDiv.classList.remove('visible');
                            } else {
                                addnDiv.classList.add('visible');
                            }
                        }
                        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                        isScrolling = false;
                    });
                    isScrolling = true;
                }
                if (window.innerWidth >= 1600) {
                    toggleTOCOnScroll();
                }
            }, false);
        }
    }

    function showHypo() {
        var existingScript = document.getElementById('hypothes-script');
        var button = contentHeader.querySelector('#show-hypo');

        var commentHypo = document.getElementById("commenthypo");

        if (!existingScript) {
            button.textContent = 'Loading';
            commentHypo.textContent = 'Loading'

            var script = document.createElement('script');
            script.id = 'hypothes-script';
            script.src = 'https://hypothes.is/embed.js';

            script.onload = () => {
                button.textContent = 'Hypothes.is';
                commentHypo.textContent = 'You can now select texts to highlight or note.'
            };

            script.onerror = () => {
                button.style.color = 'red';
                button.textContent = 'Failed';
                commentHypo.textContent = 'Network error. Please refresh and try again.'
            };

            
            document.body.appendChild(script);
        } else {
            toggleHypothesisElementsVisibility();
            button.style.color = 'var(--text-color)';
        }
    }

    function toggleHypothesisElementsVisibility() {
        const elementsToToggle = [
            'hypothesis-sidebar',
            'hypothesis-notebook',
            'hypothesis-profile',
            'hypothesis-adder',
            'hypothesis-highlight-cluster-toolbar'
        ];

        elementsToToggle.forEach(function (element) {
            var el = document.querySelector(element);
            if (el) {
                if (el.style.display === 'none') {
                    el.style.display = '';
                } else {
                    el.style.display = 'none';
                }
            }
        });
    }


    function initializeTOCFeatures() {
        if (contentHeader) {
            const contentsFixedDiv = contentHeader.querySelector('#contents-fixed');
            const tocContainer = contentHeader.querySelector('#contents-toc');
            if (contentsFixedDiv && headers.length > 1) {
                contentsFixedDiv.style.display = 'flex';
                contentsFixedDiv.addEventListener('click', (event) => {
                    toggleTOC();
                    event.stopPropagation();
                });
            }
            if (tocContainer && !tocContainer.dataset.initialized) {
                const throttledHighlight = throttle(highlightAppropriateHeader, 250);
                window.addEventListener('scroll', throttledHighlight);
                tocContainer.dataset.initialized = 'true';
            }
        }
    }

    function highlightAppropriateHeader() {
        let highlightedHeader = null;
        let foundHeaderInView = false;

        
        for (let i = 0; i < headers.length; i++) {
            const header = headers[i];
            const bounding = header.getBoundingClientRect();

            if (bounding.top >= 0 && bounding.bottom <= window.innerHeight) {
                highlightedHeader = header; 
                foundHeaderInView = true;
                break;
            }
        }

        
        if (!foundHeaderInView) {
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i];
                let nextHeader = headers[i + 1];
                let endOfSection = nextHeader ? nextHeader.getBoundingClientRect().top : Infinity;

                const startOfSection = header.getBoundingClientRect().bottom;

                if (startOfSection < window.innerHeight && endOfSection > 0) {
                    highlightedHeader = header;
                    break;
                }
            }
        }

        
        contentHeader.querySelectorAll('nav#TableOfContents a').forEach(link => {
            link.classList.remove('toc-highlight');
        });

        
        if (highlightedHeader) {
            const link = contentHeader.querySelector(`nav#TableOfContents a[href="#${highlightedHeader.id}"]`);
            if (link) {
                link.classList.add('toc-highlight');
            }
        }
    }

    function toggleTOC() {
        const tocContainer = contentHeader.querySelector('#contents-toc');
        const isDisplayed = window.getComputedStyle(tocContainer).display !== 'none';
        tocContainer.style.display = isDisplayed ? 'none' : 'flex';
    }

    function toggleTOCOnScroll() {
        const tocContainer = document.querySelector('#TableOfContents');
        const footerNav = document.querySelector('.footer-nav');

        if (!tocContainer || !footerNav) return;

        const footerNavTop = footerNav.getBoundingClientRect().top;
        const windowHeight = window.innerHeight;

        
        if (footerNavTop <= windowHeight) {
            tocContainer.style.display = 'none';
        } else {
            tocContainer.style.display = 'flex';
        }
    }

    function throttle(func, limit) {
        let lastFunc;
        let lastRan;
        return function () {
            const context = this;
            const args = arguments;
            if (!lastRan) {
                func.apply(context, args);
                lastRan = Date.now();
            } else {
                clearTimeout(lastFunc);
                lastFunc = setTimeout(function () {
                    if ((Date.now() - lastRan) >= limit) {
                        func.apply(context, args);
                        lastRan = Date.now();
                    }
                }, limit - (Date.now() - lastRan));
            }
        }
    }

    function setExternalLinksToOpenInNewTab() {
        const links = document.querySelectorAll('.e-content a[href*="//"]:not(.stream-url):not(.stream-time)');
        const linkDisplay = document.querySelector('.link-display');

        links.forEach(function (link) {
            link.setAttribute('target', '_blank');

            link.addEventListener('mouseover', function () {
                const url = new URL(this.href);
                const rootDomain = url.hostname.replace(/^www\./, '');
                const boldDomain = `<span class="bold-domain">${rootDomain}</span>`;
                const displayUrl = this.href.replace(rootDomain, boldDomain);

                linkDisplay.innerHTML = displayUrl;
                linkDisplay.style.display = 'block';
                const linkRect = this.getBoundingClientRect();
                linkDisplay.style.top = `${linkRect.bottom + window.scrollY}px`;
                linkDisplay.style.left = `${linkRect.left + window.scrollX}px`;
            });

            link.addEventListener('mouseout', function () {
                linkDisplay.style.display = 'none';
            });
        });
    }

    function setupSidenotes() {
    const sidenoteNumbers = mainElement.querySelectorAll('.sidenote-number');

    if (sidenoteNumbers.length >= 3 && window.innerWidth >= 1000) {
        const sidenoteLine = mainElement.querySelectorAll('.sidenote-line');
        sidenoteLine.forEach(element => {
            element.style.border = 'none';
        });

        var jQueryScript = document.createElement('script');
        jQueryScript.src = '/jquery-3.6.0.min.js';
        document.head.appendChild(jQueryScript);

        jQueryScript.onload = function () {
            var jsPlumbScript = document.createElement('script');
            jsPlumbScript.src = '/jsplumb.min.js';
            document.head.appendChild(jsPlumbScript);

            jsPlumbScript.onload = function () {
                initJsPlumb();
            };
        };
    }

    function applySidenoteMargins() {
        const screenWidth = window.innerWidth;

        if (screenWidth <= 1000) {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                const afterSidenoteContent = sidenoteNumber.nextSibling;

                if (sidenoteBox) {
                    if (afterSidenoteContent && afterSidenoteContent.textContent.trim() !== "") {
                        sidenoteBox.style.marginBottom = "0"; 
                    }
                }
            });
        } else {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                if (sidenoteBox) {
                    sidenoteBox.style.marginBottom = "";  
                }
            });
        }
    }

    applySidenoteMargins();

    window.addEventListener('resize', applySidenoteMargins);
}


    function initJsPlumb() {
        var jsPlumbCSS = document.createElement('link');
        jsPlumbCSS.href = '/jsplumbtoolkit-defaults.min.css';
        jsPlumbCSS.rel = 'stylesheet';
        document.head.appendChild(jsPlumbCSS);

        jQuery(document).ready(function () {
            jsPlumb.importDefaults({
                ConnectionsDetachable: false,
                ReattachConnections: false,
                Endpoint: "Blank",
                Connector: ["Straight"],
                PaintStyle: { stroke: "var(--text-color)", strokeWidth: 1 }
            });

            createConnections();
            var resizeObserver = new ResizeObserver(function () {
                createConnections();
            });
            resizeObserver.observe(document.body);
        });
    }

    function createConnections() {
        jsPlumb.deleteEveryEndpoint();
        jQuery('.sidenote-number').each(function () {
            var sidenoteNumber = jQuery(this);
            var sidenote = sidenoteNumber.find('.sidenote');

            if (sidenote.length) {
                jsPlumb.connect({
                    source: sidenoteNumber[0],
                    target: sidenote[0],
                    anchors: ["Center", "RightMiddle"],
                    cssClass: "jsplumb-line"
                });
            }
        });
    }


    function preventMultiTouchGestures() {
        window.onload = function () {
            document.addEventListener('touchstart', function (event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, false);
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            document.addEventListener('gesturestart', function (event) {
                event.preventDefault();
            }, false);
        }
    }
</script>

</html>