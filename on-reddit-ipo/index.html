<!DOCTYPE html>

<html lang="zh-Hans"  dir="ltr"

>

<head>
  <title class="p-name">On Reddit IPO - Rongbin&#39;s Blog</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="description"
    content="en | zh-hans
I only got around to reading Reddit&rsquo;s S-1 today, with a primary focus on the platform&rsquo;s internet metrics. So, some facts, as of the end of 2023:

Reddit

Active: (regardless of login status, as long as identifiable)

We define a daily active unique (“DAUq”) as a user whom we can identify with a unique identifier who has visited a page on the Reddit website, www.reddit.com, or opened a Reddit application at least once during a 24-hour period. ">
<meta name="author p-author" content="Rongbin FAN" href="https://fanrongbin.com">

<meta property="og:title" content="On Reddit IPO - Rongbin&#39;s Blog" />
<meta property="og:description" content="en | zh-hans
I only got around to reading Reddit&rsquo;s S-1 today, with a primary focus on the platform&rsquo;s internet metrics. So, some facts, as of the end of 2023:

Reddit

Active: (regardless of login status, as long as identifiable)

We define a daily active unique (“DAUq”) as a user whom we can identify with a unique identifier who has visited a page on the Reddit website, www.reddit.com, or opened a Reddit application at least once during a 24-hour period. " />
<meta property="og:url" content="https://fanrongbin.com/on-reddit-ipo/" />
<meta property="og:image" content="https://fanrongbin.com/apple-touch-icon.png" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://fanrongbin.com/apple-touch-icon.png" />
<meta name="twitter:title" content="On Reddit IPO - Rongbin&#39;s Blog" />
<meta name="twitter:description" content="en | zh-hans
I only got around to reading Reddit&rsquo;s S-1 today, with a primary focus on the platform&rsquo;s internet metrics. So, some facts, as of the end of 2023:

Reddit

Active: (regardless of login status, as long as identifiable)

We define a daily active unique (“DAUq”) as a user whom we can identify with a unique identifier who has visited a page on the Reddit website, www.reddit.com, or opened a Reddit application at least once during a 24-hour period. " />

<link rel="canonical" href="https://fanrongbin.com/on-reddit-ipo/" />






      <link rel="stylesheet" href="/css/main.min.5e7f6e7eb78e1ca467247681417e45fd90794ac322c52ec009b99ee6338f6bae.css" integrity="sha256-Xn9ufreOHKRnJHaBQX5F/ZB5SsMixS7ACbme5jOPa64=" crossorigin="anonymous">

<link rel="stylesheet" href="/han.min.css" type="text/css">





<link rel="alternate" type="application/activity+json" href="https://fed.brid.gy/r/https://fanrongbin.com/on-reddit-ipo/">

<link rel="webmention" href="https://webmention.io/fanrongbin.com/webmention" />

<script data-goatcounter="https://ron.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>

<body class="han-init-context">

  <section class="navbar">
    <span class="header-name">
    <a href="/" class="header-link h-card p-name p-author u-url u-uid">Rongbin FAN</a>
     / <a href="/posts" class="header-link">Blog</a>
    <br>
    
    <a href="/stream" class="header-link header-guestbook">ϟ Stream</a>
    <a href="/resources" class="header-link header-guestbook">↺ Resources</a>
    <a href="/links" class="header-link header-guestbook">◩ Guestbook</a>
    
</span>


  </section>

  <article class="article-entry h-entry">
      

<section class="content-header">

  <div class="top-scroll-bar"></div>
<div class="addn visible">
<a onclick="showHypo()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="show-hypo" class="header-button no-select">Hypothes.is</div></a>
<a onclick="toggleTOC()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="contents-fixed" class="header-button no-select">Contents</div></a>
</div>
<div id="contents-toc" class="no-select">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ads">Ads</a></li>
    <li><a href="#data-licensing-and-user-economy">Data Licensing and User Economy</a></li>
    <li><a href="#广告">广告</a></li>
    <li><a href="#数据授权用户经济">数据授权、用户经济</a></li>
  </ul>
</nav>
</div>

  

  <div id="single-header">
    <h1 class="p-name content-h1">On Reddit IPO</h1>
    

    
      
      
      
        
        <p class="content-time"><time class="dt-published" datetime="2024-04-01T19:33:27&#43;08:00">01 April 2024</time></p>
        
      
    

    <a rel="author" class="p-name h-card" href="https://fanrongbin.com" style="display:none;">Rongbin Fan</a>
  </div>

  

</section>





<style>
  .navbar, footer, .footer-nav, .webmentions-how, .comment-box, .comment-title {
    opacity: 0.35 !important;
  }
  .navbar:hover, footer:hover, .footer-nav:hover, .webmentions-how:hover, .comment-box:hover {
    opacity: 1 !important;
  }
</style>



<div class="link-display"></div>


      
      
      
      <main class="e-content">
      
      














    

    

    

<p><strong>en</strong> | zh-hans</p>
<p>I only got around to reading <a href="https://www.sec.gov/Archives/edgar/data/1713445/000162828024006294/reddits-1q423.htm">Reddit&rsquo;s S-1</a> today, with a primary focus on the platform&rsquo;s internet metrics. So, some facts, as of the end of 2023:</p>
<ul>
<li>Reddit
<ul>
<li>Active: (regardless of login status, as long as identifiable)
<blockquote>
<p>We define a daily active unique (“DAUq”) as a user whom we can identify with a unique identifier who has visited a page on the Reddit website, <a href="https://www.reddit.com">www.reddit.com</a>, or opened a Reddit application at least once during a 24-hour period.</p>
</blockquote>
</li>
<li><strong>Daily active uniques</strong>, DAUq (active): 73.1m (reached 60m in Q1 2023, jumped by 7.1m in Q4)<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">Facebook DAU globally 2.11b, North America 205m, META DAP (daily active person, any login to Facebook / Instagram / Messenger / WhatsApp counts) globally 3.19b (2023 10-K, as of Dec 2023)<br>X (formerly Twitter) mDAU (monetizable daily active users) globally 237.8m, US 41.5m (2022 Q2, Apr to Jun 2022)</small>
        <span class="sidenote-line"></span>
    </span>
</span>
<ul>
<li>Of these DAUq, 36.4m logged-in (~50%)</li>
<li>Of these DAUq, 36.4m from the US</li>
</ul>
</li>
<li><strong>Weekly active uniques</strong>, WAUq (active): 267.5m (saw an increase of over 20m in Q3 and also in Q4 2023)</li>
<li><strong>User persona</strong>: align with common sense, predominantly from English-speaking countries, mostly male, young and middle-aged
<ul>
<li>~50% from the US
<ul>
<li>Among US adult users, 41% are aged 18-34, 50% are male, 64% have a household income of &gt;= $75k</li>
<li>87% of US adult users don&rsquo;t use Twitch (which is kind of surprising), 73% do not use Snapchat, 68% do not use LinkedIn, 59% do not use Pinterest, 53% do not use X, 41% do not use TikTok<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">This is quite an interesting dimension especially for advertisers to determine if a platform&rsquo;s user profile suits their needs and to decide on potential exposure overlap.</small>
        <span class="sidenote-line"></span>
    </span>
</span></li>
<li>To compare with other social media platforms, see Pew Research
<ul>
<li><a href="https://www.pewresearch.org/internet/2024/01/31/americans-social-media-use/">Americans&rsquo; Social Media Use</a> (Survey period May-September 2023, 5,733 U.S. adults)</li>
<li><a href="https://www.pewresearch.org/internet/2023/12/11/teens-social-media-and-technology-2023/">Teens, Social Media and Technology 2023</a> (Survey period September-October 2023, 1,453 U.S. teens aged 13-17)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>ARPU</strong>: quarterly revenue in a given place, divided by the average DAUq in that region for the quarter
<blockquote>
<p>We define average revenue per unique (“ARPU”) as quarterly revenue in a given geography divided by the average DAUq in that geography.</p>
</blockquote>
<ul>
<li>2023 Q4: all users $3.43, US $5.51, excl. US $1.34</li>
<li>Seasonality: Q4 the highest, Q1 the lowest (contributed to the seasonality in ad business, holiday season and promotion), with 2022 total revenue at ~$667m and 2023 at ~$804m</li>
<li>Note that the growth in logged-out users can raise the denominator DAUq but unnecessarily brings revenue</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Reddit&rsquo;s growth strategy is built on three pillars: ads, data licensing, and user economy.</p>
<h2 id="ads">
Ads
<a href="#ads" class="heading-anchor">#</a>
</h2>
<p>The market size is estimated to be $1 trillion (excl. China and Russia), with an 8% CAGR, reaching $1.4 trillion in three years. Reddit also expects to have a share in the segmented search business ($750b by 2027).</p>
<p>The success of the ads business of internet companies at the end hinges on how accurately they can profile their users, and then convert this into leads. Generally, the wider the business reach / the larger the ecosystem, the more data is being accumulated, the more frequently ads banner are being updated real-time, and the more precise the profiling and strategies become (Take Alibaba as an example, from daily consumption to Fintech). Advertising is also a rapidly evolving sector with AI advancing, e.g. gaining insights from search histories, connecting dots between keywords for more precise labelling and recommendations etc.</p>
<p>Reddit values anonymity, but of course this remains at the user-to-user level, meaning users may not know who they&rsquo;ve been talking to, but the ad system will still continue to label users&rsquo; demographics. Though users are allow to leave false info or blank profiles, or to turn off customised advertising altogether, their interactions within communities still exhibit certain behavioural patterns which belong to certain groups to be identified and labelled. This works the same across all content-driven algorithms / products (YouTube, TikTok, Instagram, etc.) while in contrast to the relationship / network-driven products like Facebook (though now they all try their best to adapt content-driven models). <span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">I know that Reddit relies on community communications / comments, but this is nothing like network-driven but rather a place full of primary and secondary information generation and distribution.</small>
        <span class="sidenote-line"></span>
    </span>
</span>Reddit firstly categorises users into different interest groups based on their interactions (read, reply, vote, comment&hellip;), then goes into subcategories (e.g. Food &amp; Drink -&gt; Cooking, for someone recently visiting r/gifrecipes), and layers on other dimensions like device and location.</p>
<p>In some ways, Reddit shares some similarities with Xiaohongshu (it&rsquo;s an emerging social media platform for Chinese speakers, if you know, you know).</p>
<ol>
<li>Precisely label users by interests, and have high conversion rates</li>
<li>Lots of human-generated useful content enough to be used as a second search engine</li>
</ol>
<p>But their user personas are fundamentally different ever since their own beginning. Reddit&rsquo;s appears somewhat young and financially capable, they usually take rather a long period of time to make purchasing decisions, which is very different from Xiaohongshu&rsquo;s cause mostly of the time people go to Xiaohongshu to search what&rsquo;s the best to buy.</p>
<p>In all, Reddit&rsquo;s ads business and content-driven logic is sound, and the growth strategy mentioned in the S-1 are also solid. But they really need to be wary of:</p>
<ol>
<li>The not-so-good user profile (as mentioned earlier)</li>
<li>User habits and the underlying growth slump:
<ul>
<li>Gen Z is no longer interested in texts: how do we increase user engagement (represented by the screen time spent on the platform) and the willingness to create contents (represented by posts&rsquo; recency)?</li>
<li>Users tend to enter the platform via search engines instead of Reddit&rsquo;s own Explore page</li>
</ul>
</li>
</ol>
<h2 id="data-licensing-and-user-economy">
Data Licensing and User Economy
<a href="#data-licensing-and-user-economy" class="heading-anchor">#</a>
</h2>
<p>Relevant strategies and plans are briefly mentioned. My guess is that there would be 1) API for individuals and small businesses (roughly $0.24 per 1,000 API calls); 2) maybe some contracts with larger B2B businesses. They use the <em>broader AI market</em> for sizing which is estimated at $1 trillion by 2027. (quite conservative than I imagined)</p>
<p>The user economy model is rather familiar for us. 1) platform-based: subscription (existing Reddit Premium), digital goods (avatars, NFTs, etc.), some in-app purchasing (games); 2) commission-based: firstly led by incentivising content creation, and they could also adapt e-commerce by adding a user-to-user marketplace (no matter it is for selling digital or physical goods). This segment is estimated generously compared to other estimation, and the very unclear demand underlying, currently at $1.3 trillion and expected to reach $2.1 trillion by 2027.</p>
<hr>
<p>In all, this IPO came too late as everyone&rsquo;s attention has been shifting to short videos; the valuation is too optimistic, overestimating its main users&rsquo; purchasing power and willingness, and the scale and possibility of the user economy.</p>
<hr>
<p>en | <strong>zh-hans</strong></p>
<p>今天才坐下来看<a href="https://www.sec.gov/Archives/edgar/data/1713445/000162828024006294/reddits-1q423.htm">Reddit招股书</a>，主要关注平台metrics。23年年底：</p>
<ul>
<li>Reddit
<ul>
<li>对活跃的定义：（登不登录都算，只要能够识别）
<blockquote>
<p>We define a daily active unique (“DAUq”) as a user whom we can identify with a unique identifier who has visited a page on the Reddit website, <a href="https://www.reddit.com">www.reddit.com</a>, or opened a Reddit application at least once during a 24-hour period.</p>
</blockquote>
</li>
<li><strong>日活</strong> DAUq (active)：73.1m（23年Q1破60m，23年Q4突然较Q3涨7.1m）<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">Facebook DAU 全球2.11b、北美205m，META DAP（daily active person，Facebook / Instargam / Messenger / WhatsApp任一登录都包含在内）全球3.19b（23年报，23年12月）<br>X mDAU 全球237.8m、美国41.5m（22Q2季报，22年4-6月）</small>
        <span class="sidenote-line"></span>
    </span>
</span>
<ul>
<li>其中登录用户36.4m (~50%)</li>
<li>其中美国用户36.4m</li>
</ul>
</li>
<li><strong>周活</strong> WAUq (active)：267.5m（也是23年Q3、Q4较上一季度涨超过20m）</li>
<li><strong>用户构成</strong>：自行公布的画像跟大家认知差不多，英语国家为主、男性用户为主、中青年为主
<ul>
<li>~50%来自美国
<ul>
<li>美国成年用户中41%在18-34岁之间，50%为男性，64%家庭年收入大于等于$75k</li>
<li>美国所有访问过Reddit的用户87%不用Twitch（这是挺让我意外的）、73%不用Snapchat、68%不用LinkedIn、59%不用Pinterest、53%不用X、41%不用TikTok<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">这也是个挺好玩的维度，供广告商判断平台的用户画像到底适不适合自己投，会不会/要不要做重复曝光。</small>
        <span class="sidenote-line"></span>
    </span>
</span></li>
<li>和其他社交平台对比，可以大致参考Pew Research的：
<ul>
<li><a href="https://www.pewresearch.org/internet/2024/01/31/americans-social-media-use/">Americans&rsquo; Social Media Use</a>（统计时段23年5月-9月，统计对象5,733名美国成人）</li>
<li><a href="https://www.pewresearch.org/internet/2023/12/11/teens-social-media-and-technology-2023/">Teens, Social Media and Technology 2023</a>（统计时段23年9月-10月，统计对象1,453名美国13至17岁的青少年）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>ARPU</strong>：给定地区的季度收入，除以给定地区该季度的平均DAUq
<blockquote>
<p>We define average revenue per unique (“ARPU”) as quarterly revenue in a given geography divided by the average DAUq in that geography.</p>
</blockquote>
<ul>
<li>23年Q4全体$3.43：美国$5.51、美国以外$1.34</li>
<li>收入有明显季节特征：Q1-Q4递增（来自广告业务的季节特征，Q4年末促销冲单等等，广告做的多） ，22年总营收$~6.67亿，23年$~8.04亿。</li>
<li>注意未登录用户增长（logged-out users）会带来分母DAUq提高</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>战略上给了三板斧：广告、数据授权、用户经济（User Economy）。</p>
<h2 id="广告">
广告
<a href="#%e5%b9%bf%e5%91%8a" class="heading-anchor">#</a>
</h2>
<p>规模上（排除了中国、俄罗斯）预计目前是$1万亿，8%的年复合，3年后是$1.4万亿，Reddit还预计自己能在搜索业务（27年$750b）上分一杯羹。</p>
<p>互联网公司的广告业务，到最后是看谁给用户画像画得够准，然后能怎么有效给商家转化成线索。一般来说业务触角广或共享数据的生态圈够大，积累数据就越多，实时更新广告位也越频繁，画像和投放策略就越精准（阿里巴巴为例，衣食住行+Fintech包圆）。广告也是随AI发展迅速迭代的一个业务，例如洞察搜索记录、建立关键词之间的联系之后，能更精准地打标签和广告推荐等。</p>
<p>Reddit匿名性（anonymity）的价值观停留在user-to-user和demo层面，网友之间可能不知道对方是个什么角色，但系统内还是会继续label用户的。用户可以选择不设置年龄性别这类硬标签，或者直接把整个个性化广告的开关关掉，但在社区上的interactions依然具有某些特定的行为习惯以供识别。所有内容算法为驱动的产品都是如此（YouTube、TikTok、Instagram等），对立面是Facebook为代表的人际关系驱动（当然现在我们知道大家都在往内容驱动做）。<span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">虽然Reddit社区的核心是conversations/comments，但这显然不是一种有现实意义和强转化的关系，而是信息的二次传播和生产。</small>
        <span class="sidenote-line"></span>
    </span>
</span>Reddit先根据用户阅读、回复或vote过的帖子，初筛用户到兴趣组里（或者从sub出发，sub也能打上兴趣标签），然后切二级（例如Food &amp; Drink下的Cooking，一个最近访问过r/gifrecipes的用户就属于这个兴趣组），再layer上用户的device和location等等其他允许获取的特征。</p>
<p>某种意义上，相比贴吧，Reddit和小红书之间具有更多相似性：（事实上Reddit和贴吧之间，除了页面有点像，还有什么别的共同点？）</p>
<ol>
<li>兴趣标签精准、广告转化率比较高</li>
<li>足够多活人内容，具有往搜索引擎发展的内容资本</li>
</ol>
<p>但两者“开山鼻祖”不同，尽管用户对平台的使用方式很类似，用户画像在人口特征上天差地别，小红书上市比起Reddit上市会更让我兴奋一点（前提是摒弃市场对中概的情绪因素）。Reddit用户画像虽然看上去还算年轻、有一定购买力，但是这部分人消费决策所花费的时间太长。</p>
<p>综上，广告业务逻辑没问题，广告战略也没问题，需要警惕的是：</p>
<ol>
<li>不太乐观的用户画像（如前述）</li>
<li>用户习惯以及习惯背后的增长颓势：
<ul>
<li>Gen Z越来越看不下去一点文字，还怎么提升engagement（以使用时长为代表）和内容生产意愿（以用户搜索结果列表中帖子的发表时间为代表）？</li>
<li>最大的入口不是Reddit主站，而是搜索引擎，但搜索引擎都快自顾不暇了。</li>
</ul>
</li>
</ol>
<h2 id="数据授权用户经济">
数据授权、用户经济
<a href="#%e6%95%b0%e6%8d%ae%e6%8e%88%e6%9d%83%e7%94%a8%e6%88%b7%e7%bb%8f%e6%b5%8e" class="heading-anchor">#</a>
</h2>
<p>靠授权Reddit上的帖子用于AI/LLM训练，没细讲，大概就是对个人和小批量客户开API（Reddit自己大体估计的价格是在$0.24/1000次API调用的水平），大型to-B可能可以走contract之类的。市场规模用的是<em>broader AI market</em>，到27年$1万亿（估计得比想象中保守）。</p>
<p>用户经济的模式大家也比较喜闻乐见了，主要在平台自己做加法（订阅：现有的Reddit Premium；digital goods：头像挂件、比较geek的NFT之流；未来预期还有游戏什么的，就属于氪金增值了），或者激励内容创作、开放user-to-user marketplace等抽佣上，所以也能包括实体商品。这一块儿估计得很大，预计目前是$1.3万亿、27年$2.1万亿，但也是最虚的一块儿，看不到什么需求。</p>
<hr>
<p>综上，Reddit上市的时机太晚，大家都去看短视频了；估值不要把主力用户的消费力和消费意愿看得太高，不要对用户经济盲目乐观。</p>



          
      
          <a class="u-url" href="https://fanrongbin.com/on-reddit-ipo/" hidden="from-humans" style="display:none;"></a>
      

      </main>
      
      
      <a class="u-bridgy-fed" rel="bridgy" href="https://fed.brid.gy/" hidden="from-humans" style="display:none;"></a>

  
  </article>
  

  
  



<div class="footer-nav">




<div class="previous-post" style="display:inline-block;">
  
    
      <a class="no-external" href="/on-saas/"><span class="arrow">←</span> On SaaS</a>
    
  
</div>





<div class="next-post" style="display:inline-block;float:right;">
  
    
      <a class="no-external" href="/microsoft-365-office-ui/">Microsoft 365 中 Office 套件的两种 UI <span class="arrow">→</span></a>
    
  
</div>

</div>






  

<h2 class="comment-title">Comment</h2>

<details class="comment-box">
  <summary>Login via Github</summary>
<div id="giscus">
  <script id="giscus-script" src="https://giscus.app/client.js" data-repo="rongbinf/giscus-comment"
      data-repo-id="R_kgDOK3UYzw" data-category="Announcements"
      data-category-id="DIC_kwDOK3UYz84Cbl2R" data-mapping="pathname" data-strict="0"
      data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top"
      data-theme="https://fanrongbin.com/giscus.css" data-lang="en" data-loading="lazy"
      crossorigin="anonymous" defer>
      </script>
</div>
</details>


<details class="comment-box">
  <summary>No Login</summary>
  <div id="tcomment"></div>
  <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.36/dist/twikoo.all.min.js" integrity="sha384-4KfOjEinLSkv1i1J8TzlkC/RTnuiLoR1OLerVgjEKoH5djYtbf7mzEFsz9p3nfuA" crossorigin="anonymous" onload="initTwikoo()" defer></script>
  <script>
  function initTwikoo() {
    twikoo.init({
      envId: 'https://twikoo.fanrongbin.com',
      el: '#tcomment',
      lang: 'en',
    });
  }
  </script>
  <style>
    .twikoo svg{
      margin: 0;
    }
    .tk-avatar .tk-avatar-img {
      margin: 0;
    }
    .el-input-group__append, .el-input-group__prepend {
      background-color: unset !important;
      border: unset !important;
    }
    .el-input__inner, .el-textarea__inner {
      border: 0;
      border-bottom: 1px solid var(--text-color);
      border-radius: 0;
    }
    .el-input.is-active .el-input__inner, .el-input__inner:focus,
    .twikoo .el-input__inner:focus, .twikoo .el-textarea__inner:focus {
      border-color: var(--text-color) !important;
    }
    .el-button--primary {
      background-color: var(--highlight) !important;
    }
    .el-button--primary.is-disabled {
      background-color: var(--highlight) !important;
      border: 0 !important;
      opacity: 0.5 !important;
    }
    .twikoo .el-button:not(.el-button--primary):not(.el-button--text):hover {
      border-color: white !important;
      background-color: var(--highlight) !important;
      color: white !important;
    }
    .tk-submit-action-icon.__markdown {
      border: none;
    }
    .tk-submit-action-icon.__markdown::after {
      content: none;
    }
    .tk-icon.__comments {
      color: var(--highlight);
    }
  </style>
</details>

<details class="comment-box">
  <summary>Webmention</summary>
  <script src="/webmention.min.js" defer></script>
  <div id="webmentions"></div>
  <div>
    <p>
      
      What is <a
    href="/hugo-webmention-bridgy-mastodon">Webmention</a>?</p>
    <form class="webmention-form" action="https://webmention.io/fanrongbin.com/webmention" method="post" style="margin: 2ch 0;">
          <input type="url" name="source" class="url" placeholder="Your URL" required="">
          <input type="hidden" name="target" value="https://fanrongbin.com/on-reddit-ipo/">
          <input type="submit" value="Send" style="background:var(--bg-color);">
    </form>
  </div>
</details>

<details class="comment-box" onclick="showHypo();">
  <summary><a id="commenthypo" onclick="showHypo();">Hypothes.is</a></summary>
  </details>



  

  <footer class="opacity-6">
    <p><a href="/colophon">Colophon</a></p><p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a></p>
  </footer>

</body>

<script src="/han.min.js" defer></script>



<script type="application/json" class="js-hypothesis-config" defer>
{
    "sideBySide": {
        "mode": "manual"
    }
}
</script>

<script defer>
    var mainElement = document.querySelector('main');
    var contentHeader = document.querySelector('section.content-header');
    const headers = mainElement.querySelectorAll('h2, h3');
    document.addEventListener('DOMContentLoaded', function () {

        if (contentHeader) {
            contentHeader.querySelector('#show-hypo').style.display = 'flex';
        }

        handleScrollEvents();

        applyBreakAllClass();

        setupSidenotes();

        initializeMutationObserver();

        initializeTOCFeatures();

        preventMultiTouchGestures();

        setExternalLinksToOpenInNewTab();
    });

    function updateHHangableBehavior() {
        var sidenoteHangables = mainElement.querySelectorAll('.sidenote-number + h-hangable');
        sidenoteHangables.forEach(function (hHangable) {
            var sidenoteNumber = hHangable.previousElementSibling;
            var sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
            if (sidenoteBox) {
                sidenoteNumber.insertBefore(hHangable, sidenoteBox);
            }
        });
    }

    function initializeMutationObserver() {
        var observer = new MutationObserver(function (mutations) {
            var shouldUpdate = false;
            mutations.forEach(function (mutation) {
                mutation.addedNodes.forEach(function (node) {
                    if (node.nodeType === 1 && node.matches('h-hangable')) {
                        var previousSibling = node.previousElementSibling;
                        if (previousSibling && previousSibling.matches('.sidenote-number')) {
                            shouldUpdate = true;
                        }
                    }
                });
            });
            if (shouldUpdate) {
                setTimeout(updateHHangableBehavior, 1200);
            }
        });

        var config = { childList: true, subtree: true };
        if (mainElement) {
            observer.observe(mainElement, config);
        }
    }

    function applyBreakAllClass() {
        var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var codeElements = mainElement.querySelectorAll('code');

        codeElements.forEach(function (element) {
            if (screenWidth <= 960) {
                if (element.textContent.length > 10) {
                    element.classList.add('break-all');
                }
            }
            else {
                if (element.textContent.length > 30) {
                    element.classList.add('break-all');
                }
            }
        });
    }

    function handleScrollEvents() {
        if (contentHeader) {
            let lastScrollTop = 0;
            let isScrolling = false;
            const addnDiv = contentHeader.querySelector('.addn');
            const topScrollBar = contentHeader.querySelector('.top-scroll-bar');

            window.addEventListener('scroll', function () {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (!isScrolling) {
                    window.requestAnimationFrame(function () {
                        if (topScrollBar) {
                            const scrollPercent = (currentScroll / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                            topScrollBar.style.width = scrollPercent + '%';
                            topScrollBar.style.display = 'block';
                        }
                        if (addnDiv) {
                            if (currentScroll > lastScrollTop && currentScroll > 50) {
                                addnDiv.classList.remove('visible');
                            } else {
                                addnDiv.classList.add('visible');
                            }
                        }
                        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                        isScrolling = false;
                    });
                    isScrolling = true;
                }
                if (window.innerWidth >= 1600) {
                    toggleTOCOnScroll();
                }
            }, false);
        }
    }

    function showHypo() {
        var existingScript = document.getElementById('hypothes-script');
        var button = contentHeader.querySelector('#show-hypo');

        var commentHypo = document.getElementById("commenthypo");

        if (!existingScript) {
            button.textContent = 'Loading';
            commentHypo.textContent = 'Loading'

            var script = document.createElement('script');
            script.id = 'hypothes-script';
            script.src = 'https://hypothes.is/embed.js';

            script.onload = () => {
                button.textContent = 'Hypothes.is';
                commentHypo.textContent = 'You can now select texts to highlight or note.'
            };

            script.onerror = () => {
                button.style.color = 'red';
                button.textContent = 'Failed';
                commentHypo.textContent = 'Network error. Please refresh and try again.'
            };

            
            document.body.appendChild(script);
        } else {
            toggleHypothesisElementsVisibility();
            button.style.color = 'var(--text-color)';
        }
    }

    function toggleHypothesisElementsVisibility() {
        const elementsToToggle = [
            'hypothesis-sidebar',
            'hypothesis-notebook',
            'hypothesis-profile',
            'hypothesis-adder',
            'hypothesis-highlight-cluster-toolbar'
        ];

        elementsToToggle.forEach(function (element) {
            var el = document.querySelector(element);
            if (el) {
                if (el.style.display === 'none') {
                    el.style.display = '';
                } else {
                    el.style.display = 'none';
                }
            }
        });
    }


    function initializeTOCFeatures() {
        if (contentHeader) {
            const contentsFixedDiv = contentHeader.querySelector('#contents-fixed');
            const tocContainer = contentHeader.querySelector('#contents-toc');
            if (contentsFixedDiv && headers.length > 1) {
                contentsFixedDiv.style.display = 'flex';
                contentsFixedDiv.addEventListener('click', (event) => {
                    toggleTOC();
                    event.stopPropagation();
                });
            }
            if (tocContainer && !tocContainer.dataset.initialized) {
                const throttledHighlight = throttle(highlightAppropriateHeader, 250);
                window.addEventListener('scroll', throttledHighlight);
                tocContainer.dataset.initialized = 'true';
            }
        }
    }

    function highlightAppropriateHeader() {
        let highlightedHeader = null;
        let foundHeaderInView = false;

        
        for (let i = 0; i < headers.length; i++) {
            const header = headers[i];
            const bounding = header.getBoundingClientRect();

            if (bounding.top >= 0 && bounding.bottom <= window.innerHeight) {
                highlightedHeader = header; 
                foundHeaderInView = true;
                break;
            }
        }

        
        if (!foundHeaderInView) {
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i];
                let nextHeader = headers[i + 1];
                let endOfSection = nextHeader ? nextHeader.getBoundingClientRect().top : Infinity;

                const startOfSection = header.getBoundingClientRect().bottom;

                if (startOfSection < window.innerHeight && endOfSection > 0) {
                    highlightedHeader = header;
                    break;
                }
            }
        }

        
        contentHeader.querySelectorAll('nav#TableOfContents a').forEach(link => {
            link.classList.remove('toc-highlight');
        });

        
        if (highlightedHeader) {
            const link = contentHeader.querySelector(`nav#TableOfContents a[href="#${highlightedHeader.id}"]`);
            if (link) {
                link.classList.add('toc-highlight');
            }
        }
    }

    function toggleTOC() {
        const tocContainer = contentHeader.querySelector('#contents-toc');
        const isDisplayed = window.getComputedStyle(tocContainer).display !== 'none';
        tocContainer.style.display = isDisplayed ? 'none' : 'flex';
    }

    function toggleTOCOnScroll() {
        const tocContainer = document.querySelector('#TableOfContents');
        const footerNav = document.querySelector('.footer-nav');

        if (!tocContainer || !footerNav) return;

        const footerNavTop = footerNav.getBoundingClientRect().top;
        const windowHeight = window.innerHeight;

        
        if (footerNavTop <= windowHeight) {
            tocContainer.style.display = 'none';
        } else {
            tocContainer.style.display = 'flex';
        }
    }

    function throttle(func, limit) {
        let lastFunc;
        let lastRan;
        return function () {
            const context = this;
            const args = arguments;
            if (!lastRan) {
                func.apply(context, args);
                lastRan = Date.now();
            } else {
                clearTimeout(lastFunc);
                lastFunc = setTimeout(function () {
                    if ((Date.now() - lastRan) >= limit) {
                        func.apply(context, args);
                        lastRan = Date.now();
                    }
                }, limit - (Date.now() - lastRan));
            }
        }
    }

    function setExternalLinksToOpenInNewTab() {
        const links = document.querySelectorAll('.e-content a[href*="//"]:not(.stream-url):not(.stream-time)');
        const linkDisplay = document.querySelector('.link-display');

        links.forEach(function (link) {
            link.setAttribute('target', '_blank');

            link.addEventListener('mouseover', function () {
                const url = new URL(this.href);
                const rootDomain = url.hostname.replace(/^www\./, '');
                const boldDomain = `<span class="bold-domain">${rootDomain}</span>`;
                const displayUrl = this.href.replace(rootDomain, boldDomain);

                linkDisplay.innerHTML = displayUrl;
                linkDisplay.style.display = 'block';
                const linkRect = this.getBoundingClientRect();
                linkDisplay.style.top = `${linkRect.bottom + window.scrollY}px`;
                linkDisplay.style.left = `${linkRect.left + window.scrollX}px`;
            });

            link.addEventListener('mouseout', function () {
                linkDisplay.style.display = 'none';
            });
        });
    }

    function setupSidenotes() {
    const sidenoteNumbers = mainElement.querySelectorAll('.sidenote-number');

    if (sidenoteNumbers.length >= 3 && window.innerWidth >= 1000) {
        const sidenoteLine = mainElement.querySelectorAll('.sidenote-line');
        sidenoteLine.forEach(element => {
            element.style.border = 'none';
        });

        var jQueryScript = document.createElement('script');
        jQueryScript.src = '/jquery-3.6.0.min.js';
        document.head.appendChild(jQueryScript);

        jQueryScript.onload = function () {
            var jsPlumbScript = document.createElement('script');
            jsPlumbScript.src = '/jsplumb.min.js';
            document.head.appendChild(jsPlumbScript);

            jsPlumbScript.onload = function () {
                initJsPlumb();
            };
        };
    }

    function applySidenoteMargins() {
        const screenWidth = window.innerWidth;

        if (screenWidth <= 1000) {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                const afterSidenoteContent = sidenoteNumber.nextSibling;

                if (sidenoteBox) {
                    if (afterSidenoteContent && afterSidenoteContent.textContent.trim() !== "") {
                        sidenoteBox.style.marginBottom = "0"; 
                    }
                }
            });
        } else {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                if (sidenoteBox) {
                    sidenoteBox.style.marginBottom = "";  
                }
            });
        }
    }

    applySidenoteMargins();

    window.addEventListener('resize', applySidenoteMargins);
}


    function initJsPlumb() {
        var jsPlumbCSS = document.createElement('link');
        jsPlumbCSS.href = '/jsplumbtoolkit-defaults.min.css';
        jsPlumbCSS.rel = 'stylesheet';
        document.head.appendChild(jsPlumbCSS);

        jQuery(document).ready(function () {
            jsPlumb.importDefaults({
                ConnectionsDetachable: false,
                ReattachConnections: false,
                Endpoint: "Blank",
                Connector: ["Straight"],
                PaintStyle: { stroke: "var(--text-color)", strokeWidth: 1 }
            });

            createConnections();
            var resizeObserver = new ResizeObserver(function () {
                createConnections();
            });
            resizeObserver.observe(document.body);
        });
    }

    function createConnections() {
        jsPlumb.deleteEveryEndpoint();
        jQuery('.sidenote-number').each(function () {
            var sidenoteNumber = jQuery(this);
            var sidenote = sidenoteNumber.find('.sidenote');

            if (sidenote.length) {
                jsPlumb.connect({
                    source: sidenoteNumber[0],
                    target: sidenote[0],
                    anchors: ["Center", "RightMiddle"],
                    cssClass: "jsplumb-line"
                });
            }
        });
    }


    function preventMultiTouchGestures() {
        window.onload = function () {
            document.addEventListener('touchstart', function (event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, false);
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            document.addEventListener('gesturestart', function (event) {
                event.preventDefault();
            }, false);
        }
    }
</script>

</html>