<!DOCTYPE html>

<html lang="en"  dir="ltr"

>

<head>
  <title class="p-name">My ~Flow~ of Knowledge - Rongbin&#39;s Blog</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="description"
    content="My flow (version 0.1) is based on The Knowledge Cycle:

1. Research
#


Source

It&rsquo;s okay to be an omnivore as long as you keep your plate and tablecloth clean.
What

Articles: RSS reader (NetNewsWire, shifting to self-hosting), mail inboxes for newsletters, social media
Books and Essays: Apple Books, PDF reader




Screen out those that I&rsquo;m going to read

Use my mobile devices.
Do this to kill time when queuing, waiting&hellip;
How

Send to a separate email address for later reading and archive.
Delete those that I will not read. Don&rsquo;t pile it up again.




Save/Archive

How

Pocket and Readwise Reader currently, shifting to save as *.md files
    
        Raw *.md files go to my OneDrive and later my NAS. Only keep notes and quotes in Obsidian.
        
    







2. Reading
#


If the content can be understood by reading it once, don&rsquo;t read it twice. If it should be read twice, then make a bookmark.
If I want to highlight, leave relevant notes as well.
Read articles on the computer, and books on the iPad.


3. Taking lasting notes
#


Note cards and reference cards (quotes): Obsidian
Highlight will be moved from Readwise Reader to Obsidian reference cards


4. Compose blog posts based on notes
#


Scheduled/Structured writing projects: Logseq as my to-do list and to categorise
Topics derive from readings: Start the cycle again
Curation: Hybrid project to share great articles, highlights, notes

To get into this pure flow, step 0 is to: clear up my email inboxes, RSS reader, browser bookmarks, Books app on my iPad, and Telegram channels. ">
<meta name="author p-author" content="Rongbin FAN" href="https://fanrongbin.com">

<meta property="og:title" content='My ~Flow~ of Knowledge - Rongbin&#39;s Blog' />
<meta property="og:description" content="My flow (version 0.1) is based on The Knowledge Cycle:

1. Research
#


Source

It&rsquo;s okay to be an omnivore as long as you keep your plate and tablecloth clean.
What

Articles: RSS reader (NetNewsWire, shifting to self-hosting), mail inboxes for newsletters, social media
Books and Essays: Apple Books, PDF reader




Screen out those that I&rsquo;m going to read

Use my mobile devices.
Do this to kill time when queuing, waiting&hellip;
How

Send to a separate email address for later reading and archive.
Delete those that I will not read. Don&rsquo;t pile it up again.




Save/Archive

How

Pocket and Readwise Reader currently, shifting to save as *.md files
    
        Raw *.md files go to my OneDrive and later my NAS. Only keep notes and quotes in Obsidian.
        
    







2. Reading
#


If the content can be understood by reading it once, don&rsquo;t read it twice. If it should be read twice, then make a bookmark.
If I want to highlight, leave relevant notes as well.
Read articles on the computer, and books on the iPad.


3. Taking lasting notes
#


Note cards and reference cards (quotes): Obsidian
Highlight will be moved from Readwise Reader to Obsidian reference cards


4. Compose blog posts based on notes
#


Scheduled/Structured writing projects: Logseq as my to-do list and to categorise
Topics derive from readings: Start the cycle again
Curation: Hybrid project to share great articles, highlights, notes

To get into this pure flow, step 0 is to: clear up my email inboxes, RSS reader, browser bookmarks, Books app on my iPad, and Telegram channels. " />
<meta property="og:url" content="https://fanrongbin.com/flow/" />
<meta property="og:image" content="https://fanrongbin.com/apple-touch-icon.png" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://fanrongbin.com/apple-touch-icon.png" />
<meta name="twitter:title" content='My ~Flow~ of Knowledge - Rongbin&#39;s Blog' />
<meta name="twitter:description" content="My flow (version 0.1) is based on The Knowledge Cycle:

1. Research
#


Source

It&rsquo;s okay to be an omnivore as long as you keep your plate and tablecloth clean.
What

Articles: RSS reader (NetNewsWire, shifting to self-hosting), mail inboxes for newsletters, social media
Books and Essays: Apple Books, PDF reader




Screen out those that I&rsquo;m going to read

Use my mobile devices.
Do this to kill time when queuing, waiting&hellip;
How

Send to a separate email address for later reading and archive.
Delete those that I will not read. Don&rsquo;t pile it up again.




Save/Archive

How

Pocket and Readwise Reader currently, shifting to save as *.md files
    
        Raw *.md files go to my OneDrive and later my NAS. Only keep notes and quotes in Obsidian.
        
    







2. Reading
#


If the content can be understood by reading it once, don&rsquo;t read it twice. If it should be read twice, then make a bookmark.
If I want to highlight, leave relevant notes as well.
Read articles on the computer, and books on the iPad.


3. Taking lasting notes
#


Note cards and reference cards (quotes): Obsidian
Highlight will be moved from Readwise Reader to Obsidian reference cards


4. Compose blog posts based on notes
#


Scheduled/Structured writing projects: Logseq as my to-do list and to categorise
Topics derive from readings: Start the cycle again
Curation: Hybrid project to share great articles, highlights, notes

To get into this pure flow, step 0 is to: clear up my email inboxes, RSS reader, browser bookmarks, Books app on my iPad, and Telegram channels. " />

<link rel="canonical" href="https://fanrongbin.com/flow/" />






      <link rel="stylesheet" href="/css/main.min.7154fca98a197f082c4a1ebc1e6ac393acd86e4855b1bd5fe96cdc9e33524de8.css" integrity="sha256-cVT8qYoZfwgsSh68HmrDk6zYbkhVsb1f6WzcnjNSTeg=" crossorigin="anonymous">

<link rel="stylesheet" href="/han.min.css" type="text/css">





<link rel="alternate" type="application/activity+json" href="https://fed.brid.gy/r/https://fanrongbin.com/flow/">

<link rel="webmention" href="https://webmention.io/fanrongbin.com/webmention" />

<script data-goatcounter="https://ron.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>

<body class="han-init-context">

  <section class="navbar">
    <span class="header-name">
    <a href="/" class="header-link h-card p-name p-author u-url u-uid">Rongbin FAN</a>
     / <a href="/posts" class="header-link">Blog</a>
    <br>
    <a href="/stream" class="header-link header-guestbook">ϟ Stream</a>
    
    <a href="/links" class="header-link header-guestbook">◩ Guestbook</a>
    
</span>


  </section>

  <article class="article-entry h-entry">
      

<section class="content-header">

  <div class="top-scroll-bar"></div>
<div class="addn visible">
<a onclick="showHypo()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="show-hypo" class="header-button no-select">Hypothes.is</div></a>
<a onclick="toggleTOC()" style="color:var(--textcolor);text-decoration:none;border:none;"><div id="contents-fixed" class="header-button no-select">Contents</div></a>
</div>
<div id="contents-toc" class="no-select">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-research">1. Research</a></li>
    <li><a href="#2-reading">2. Reading</a></li>
    <li><a href="#3-taking-lasting-notes">3. Taking lasting notes</a></li>
    <li><a href="#4-compose-blog-posts-based-on-notes">4. Compose blog posts based on notes</a></li>
    <li><a href="#why-i-leave-platforms">Why I leave platforms</a></li>
    <li><a href="#flow"><del>Flow</del></a></li>
  </ul>
</nav>
</div>

  

  <div id="single-header">
    <h1 class="p-name content-h1">My ~Flow~ of Knowledge</h1>
    

    
      
      
      
        
        <p class="content-time"><time class="dt-published" datetime="2024-01-16T13:57:27&#43;08:00">16 January 2024</time></p>
        
      
    

    <a rel="author" class="p-name h-card" href="https://fanrongbin.com" style="display:none;">Rongbin Fan</a>
  </div>

  

</section>





<style>
  .navbar, footer, .footer-nav, .webmentions-how, .comment-box, .comment-title {
    opacity: 0.35 !important;
  }
  .navbar:hover, footer:hover, .footer-nav:hover, .webmentions-how:hover, .comment-box:hover {
    opacity: 1 !important;
  }
</style>



<div class="link-display"></div>


      
      
      
      <main class="e-content">
      
      














    

    

    

    

<p>My flow (version 0.1) is based on <a href="https://zettelkasten.de/posts/knowledge-cycle-efficiently-organize-writing-projects/">The Knowledge Cycle</a>:</p>
<h2 id="1-research">
1. Research
<a href="#1-research" class="heading-anchor">#</a>
</h2>
<ul>
<li><strong>Source</strong>
<ul>
<li>It&rsquo;s okay to be an omnivore as long as you keep your plate and tablecloth clean.</li>
<li>What
<ul>
<li>Articles: RSS reader (NetNewsWire, shifting to self-hosting), mail inboxes for newsletters, social media</li>
<li>Books and Essays: Apple Books, PDF reader</li>
</ul>
</li>
</ul>
</li>
<li><strong>Screen out those that I&rsquo;m going to read</strong>
<ul>
<li>Use my mobile devices.</li>
<li>Do this to kill time when queuing, waiting&hellip;</li>
<li>How
<ul>
<li>Send to a separate email address for later reading and archive.</li>
<li>Delete those that I will not read. <a href="https://zettelkasten.de/posts/collectors-fallacy/">Don&rsquo;t pile it up again.</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Save/Archive</strong>
<ul>
<li>How
<ul>
<li>Pocket and Readwise Reader currently, shifting to <a href="https://github.com/deathau/markdownload">save as <code>*.md</code> files</a><span class="sidenote-number">
    <span class="sidenote-box">
        <small class="sidenote">Raw <code>*.md</code> files go to my OneDrive and later my NAS. Only keep notes and quotes in Obsidian.</small>
        <span class="sidenote-line"></span>
    </span>
</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-reading">
2. Reading
<a href="#2-reading" class="heading-anchor">#</a>
</h2>
<ul>
<li>If the content can be understood by reading it once, don&rsquo;t read it twice. If it should be read twice, then make a bookmark.</li>
<li>If I want to highlight, leave relevant notes as well.</li>
<li>Read articles on the computer, and books on the iPad.</li>
</ul>
<h2 id="3-taking-lasting-notes">
3. Taking lasting notes
<a href="#3-taking-lasting-notes" class="heading-anchor">#</a>
</h2>
<ul>
<li><strong>Note cards and reference cards (quotes):</strong> Obsidian</li>
<li><strong>Highlight</strong> will be moved from Readwise Reader to Obsidian reference cards</li>
</ul>
<h2 id="4-compose-blog-posts-based-on-notes">
4. Compose blog posts based on notes
<a href="#4-compose-blog-posts-based-on-notes" class="heading-anchor">#</a>
</h2>
<ul>
<li><strong>Scheduled/Structured writing projects:</strong> Logseq as my to-do list and to categorise</li>
<li><strong>Topics derive from readings:</strong> Start the cycle again</li>
<li><strong>Curation:</strong> <em>Hybrid</em> project to share great articles, highlights, notes</li>
</ul>
<p>To get into this <em>pure</em> flow, step 0 is to: clear up my email inboxes, RSS reader, browser bookmarks, Books app on my iPad, and Telegram channels.</p>
<ul>
<li>If it&rsquo;s possible to subscribe via RSS, then embrace the good old RSS.</li>
<li>Curate the newsletter subscription list. Only keep those you feel necessary to be notified when new pieces come.
<ul>
<li>Receive important push notifications only. (especially for Telegram channels)</li>
</ul>
</li>
<li>Minimise the usage of social media.</li>
<li>Don&rsquo;t follow the same public media on different platforms.</li>
</ul>
<h2 id="why-i-leave-platforms">
Why I leave platforms
<a href="#why-i-leave-platforms" class="heading-anchor">#</a>
</h2>
<p>The main reason I turn to raw <code>*.md</code> files and Obsidian is my upgraded appetite for long-lasting information as someone diagnosed with <a href="https://zettelkasten.de/posts/collectors-fallacy/">the collector&rsquo;s fallacy</a> and currently under treatment. I want to keep what I&rsquo;ve read <em>offline</em> and store it <em>locally</em>, so no worrying about platforms shutting down, page URLs going invalid, or authors deleting the whole site (I know it&rsquo;s their right to do so, and it&rsquo;s also my right to download the public internet). This reduces my monthly expenses on SaaS, too.</p>
<hr>
<h2 id="flow">
<del>Flow</del>
<a href="#flow" class="heading-anchor">#</a>
</h2>
<p>Inspired by <a href="https://zettelkasten.de/posts/overview">the Zettelkasten blog series</a>, I created this page to document my daily routine (or let&rsquo;s say, <em>flow</em>) of processing information and turning that into solid knowledge. I try to craft an organised, for-the-future, and go-offline-at-any-time learning system, so this page works as a storyteller of this journey, a guide for anyone who looks for similar purposes, and my manifesto to stick to this routine, <em>flow with the flow</em>.</p>
<p>While looking for suitable tools, I thought of starting a <a href="https://en.wikipedia.org/wiki/Webring">webring</a> to gather insights into how others manage their knowledge and arrange their working/learning process, including tools and theories they employ. This can serve as a community to discuss, or an index for internet nomads to discover new ways and perspectives.</p>
<p>But why limit it to only be about productivity, about knowledge management? I simply ask myself. Every pursuit and every lifestyle has a unique flow in it to tell the story of <em>who I am</em>, and taking a peek into how others <em>live</em>, not just the &ldquo;boring&rdquo; how-you-take-notes, can give us so many fresh ideas and stories, same as what <a href="https://nownownow.com/about">now pages</a>, <a href="https://hackerstations.com/">Hacker Station</a>, and <a href="https://www.theproofwellness.com/interviews">The Proof</a> has been doing. So this is <strong><a href="https://flow-webring.netlify.app/"><del>Flow</del></a>,</strong> a webring working as a bookmark to collect people&rsquo;s flows, and a line connecting dots with thoughts on the internet. It can be about how you manage your knowledge, brew coffee, write codes, spend an ordinary Sunday afternoon, research, create, and many more. It is about <strong>you</strong> and <strong>your way of life</strong>.</p>
<p>More importantly, sharing your flow with others via a single webpage might help you establish a <em>way</em> that you can stick to, keep changelogs, and iterate for a very long time. I&rsquo;ve been caught up in productivity <em>tools</em> for some time, doing nothing but digging the App Store, SSPAI, Product Hunt, and v2ex to find new apps. And this makes me almost forget the real support behind—thoughts. Tools are here to reduce the coefficient of friction in your workflow, but this coefficient starts at such a low level and will not bring a strong impact on your dependent variable, which is your solid output. This passion towards tools/applications seems to be alike coffee lovers pursuing better coffee machines, pots, percolators, or filters, but there&rsquo;s no tangible result like a cup of wonderful espresso for you to enjoy without good coffee beans, water, and temperature. Coffee machine to coffee is what productivity tool to productivity.</p>
<p>Jot down your flow, practice it, make it better, and write down why—it&rsquo;s a fresh start.</p>
<div style="width:88px;height:31px;display:flex;flex-direction:row;">
<a class="no-external" href="https://flow-webring.netlify.app/rongbin/previous"><img src="https://flow-webring.netlify.app/flow-badge-prev-next.png"></a>
<a class="no-external" href="https://flow-webring.netlify.app"><img src="https://flow-webring.netlify.app/flow-badge.gif"></a>
<a class="no-external" href="https://flow-webring.netlify.app/rongbin/next"><img src="https://flow-webring.netlify.app/flow-badge-prev-next.png"></a>
</div>


          
      
          <a class="u-url" href="https://fanrongbin.com/flow/" hidden="from-humans" style="display:none;"></a>
      

      </main>
      
      
      <a class="u-bridgy-fed" rel="bridgy" href="https://fed.brid.gy/" hidden="from-humans" style="display:none;"></a>

  
  </article>
  

  
  



<div class="footer-nav">




<div class="previous-post" style="display:inline-block;">
  
    
      <a class="no-external" href="/colophon/"><span class="arrow">←</span> Colophon</a>
    
  
</div>





<div class="next-post" style="display:inline-block;float:right;">
  
</div>

</div>






  

<h2 class="comment-title">Comment</h2>

<details class="comment-box">
  <summary>Login via Github</summary>
<div id="giscus">
  <script id="giscus-script" src="https://giscus.app/client.js" data-repo="rongbinf/giscus-comment"
      data-repo-id="R_kgDOK3UYzw" data-category="Announcements"
      data-category-id="DIC_kwDOK3UYz84Cbl2R" data-mapping="pathname" data-strict="0"
      data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top"
      data-theme="https://fanrongbin.com/giscus.css" data-lang="en" data-loading="lazy"
      crossorigin="anonymous" defer>
      </script>
</div>
</details>


<details class="comment-box">
  <summary>No Login</summary>
  <div id="tcomment"></div>
  <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.36/dist/twikoo.all.min.js" integrity="sha384-4KfOjEinLSkv1i1J8TzlkC/RTnuiLoR1OLerVgjEKoH5djYtbf7mzEFsz9p3nfuA" crossorigin="anonymous" onload="initTwikoo()" defer></script>
  <script>
  function initTwikoo() {
    twikoo.init({
      envId: 'https://twikoo.fanrongbin.com',
      el: '#tcomment',
      lang: 'en',
    });
  }
  </script>
  <style>
    .twikoo svg{
      margin: 0;
    }
    .tk-avatar .tk-avatar-img {
      margin: 0;
    }
    .el-input-group__append, .el-input-group__prepend {
      background-color: unset !important;
      border: unset !important;
    }
    .el-input__inner, .el-textarea__inner {
      border: 0;
      border-bottom: 1px solid var(--text-color);
      border-radius: 0;
    }
    .el-input.is-active .el-input__inner, .el-input__inner:focus,
    .twikoo .el-input__inner:focus, .twikoo .el-textarea__inner:focus {
      border-color: var(--text-color) !important;
    }
    .el-button--primary {
      background-color: var(--highlight) !important;
    }
    .el-button--primary.is-disabled {
      background-color: var(--highlight) !important;
      border: 0 !important;
      opacity: 0.5 !important;
    }
    .twikoo .el-button:not(.el-button--primary):not(.el-button--text):hover {
      border-color: white !important;
      background-color: var(--highlight) !important;
      color: white !important;
    }
    .tk-submit-action-icon.__markdown {
      border: none;
    }
    .tk-submit-action-icon.__markdown::after {
      content: none;
    }
    .tk-icon.__comments {
      color: var(--highlight);
    }
  </style>
</details>

<details class="comment-box">
  <summary>Webmention</summary>
  <script src="/webmention.min.js" defer></script>
  <div id="webmentions"></div>
  <div>
    <p>
      
      What is <a
    href="/hugo-webmention-bridgy-mastodon">Webmention</a>?</p>
    <form class="webmention-form" action="https://webmention.io/fanrongbin.com/webmention" method="post" style="margin: 2ch 0;">
          <input type="url" name="source" class="url" placeholder="Your URL" required="">
          <input type="hidden" name="target" value="https://fanrongbin.com/flow/">
          <input type="submit" value="Send" style="background:var(--bg-color);">
    </form>
  </div>
</details>

<details class="comment-box" onclick="showHypo();">
  <summary><a id="commenthypo" onclick="showHypo();">Hypothes.is</a></summary>
  </details>



  

  <footer class="opacity-6">
    <p><a href="/colophon">Colophon</a></p><p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a></p>
  </footer>

</body>

<script src="/han.min.js" defer></script>



<script type="application/json" class="js-hypothesis-config" defer>
{
    "sideBySide": {
        "mode": "manual"
    }
}
</script>

<script defer>
    var mainElement = document.querySelector('main');
    var contentHeader = document.querySelector('section.content-header');
    const headers = mainElement.querySelectorAll('h2, h3');
    document.addEventListener('DOMContentLoaded', function () {

        if (contentHeader) {
            contentHeader.querySelector('#show-hypo').style.display = 'flex';
        }

        handleScrollEvents();

        applyBreakAllClass();

        setupSidenotes();

        initializeMutationObserver();

        initializeTOCFeatures();

        preventMultiTouchGestures();

        setExternalLinksToOpenInNewTab();
    });

    function updateHHangableBehavior() {
        var sidenoteHangables = mainElement.querySelectorAll('.sidenote-number + h-hangable');
        sidenoteHangables.forEach(function (hHangable) {
            var sidenoteNumber = hHangable.previousElementSibling;
            var sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
            if (sidenoteBox) {
                sidenoteNumber.insertBefore(hHangable, sidenoteBox);
            }
        });
    }

    function initializeMutationObserver() {
        var observer = new MutationObserver(function (mutations) {
            var shouldUpdate = false;
            mutations.forEach(function (mutation) {
                mutation.addedNodes.forEach(function (node) {
                    if (node.nodeType === 1 && node.matches('h-hangable')) {
                        var previousSibling = node.previousElementSibling;
                        if (previousSibling && previousSibling.matches('.sidenote-number')) {
                            shouldUpdate = true;
                        }
                    }
                });
            });
            if (shouldUpdate) {
                setTimeout(updateHHangableBehavior, 1200);
            }
        });

        var config = { childList: true, subtree: true };
        if (mainElement) {
            observer.observe(mainElement, config);
        }
    }

    function applyBreakAllClass() {
        var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var codeElements = mainElement.querySelectorAll('code');

        codeElements.forEach(function (element) {
            if (screenWidth <= 960) {
                if (element.textContent.length > 10) {
                    element.classList.add('break-all');
                }
            }
            else {
                if (element.textContent.length > 30) {
                    element.classList.add('break-all');
                }
            }
        });
    }

    function handleScrollEvents() {
        if (contentHeader) {
            let lastScrollTop = 0;
            let isScrolling = false;
            const addnDiv = contentHeader.querySelector('.addn');
            const topScrollBar = contentHeader.querySelector('.top-scroll-bar');

            window.addEventListener('scroll', function () {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (!isScrolling) {
                    window.requestAnimationFrame(function () {
                        if (topScrollBar) {
                            const scrollPercent = (currentScroll / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                            topScrollBar.style.width = scrollPercent + '%';
                            topScrollBar.style.display = 'block';
                        }
                        if (addnDiv) {
                            if (currentScroll > lastScrollTop && currentScroll > 50) {
                                addnDiv.classList.remove('visible');
                            } else {
                                addnDiv.classList.add('visible');
                            }
                        }
                        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                        isScrolling = false;
                    });
                    isScrolling = true;
                }
                if (window.innerWidth >= 1600) {
                    toggleTOCOnScroll();
                }
            }, false);
        }
    }

    function showHypo() {
        var existingScript = document.getElementById('hypothes-script');
        var button = contentHeader.querySelector('#show-hypo');

        var commentHypo = document.getElementById("commenthypo");

        if (!existingScript) {
            button.textContent = 'Loading';
            commentHypo.textContent = 'Loading'

            var script = document.createElement('script');
            script.id = 'hypothes-script';
            script.src = 'https://hypothes.is/embed.js';

            script.onload = () => {
                button.textContent = 'Hypothes.is';
                commentHypo.textContent = 'You can now select texts to highlight or note.'
            };

            script.onerror = () => {
                button.style.color = 'red';
                button.textContent = 'Failed';
                commentHypo.textContent = 'Network error. Please refresh and try again.'
            };

            
            document.body.appendChild(script);
        } else {
            toggleHypothesisElementsVisibility();
            button.style.color = 'var(--text-color)';
        }
    }

    function toggleHypothesisElementsVisibility() {
        const elementsToToggle = [
            'hypothesis-sidebar',
            'hypothesis-notebook',
            'hypothesis-profile',
            'hypothesis-adder',
            'hypothesis-highlight-cluster-toolbar'
        ];

        elementsToToggle.forEach(function (element) {
            var el = document.querySelector(element);
            if (el) {
                if (el.style.display === 'none') {
                    el.style.display = '';
                } else {
                    el.style.display = 'none';
                }
            }
        });
    }


    function initializeTOCFeatures() {
        if (contentHeader) {
            const contentsFixedDiv = contentHeader.querySelector('#contents-fixed');
            const tocContainer = contentHeader.querySelector('#contents-toc');
            if (contentsFixedDiv && headers.length > 1) {
                contentsFixedDiv.style.display = 'flex';
                contentsFixedDiv.addEventListener('click', (event) => {
                    toggleTOC();
                    event.stopPropagation();
                });
            }
            if (tocContainer && !tocContainer.dataset.initialized) {
                const throttledHighlight = throttle(highlightAppropriateHeader, 250);
                window.addEventListener('scroll', throttledHighlight);
                tocContainer.dataset.initialized = 'true';
            }
        }
    }

    function highlightAppropriateHeader() {
        let highlightedHeader = null;
        let foundHeaderInView = false;

        
        for (let i = 0; i < headers.length; i++) {
            const header = headers[i];
            const bounding = header.getBoundingClientRect();

            if (bounding.top >= 0 && bounding.bottom <= window.innerHeight) {
                highlightedHeader = header; 
                foundHeaderInView = true;
                break;
            }
        }

        
        if (!foundHeaderInView) {
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i];
                let nextHeader = headers[i + 1];
                let endOfSection = nextHeader ? nextHeader.getBoundingClientRect().top : Infinity;

                const startOfSection = header.getBoundingClientRect().bottom;

                if (startOfSection < window.innerHeight && endOfSection > 0) {
                    highlightedHeader = header;
                    break;
                }
            }
        }

        
        contentHeader.querySelectorAll('nav#TableOfContents a').forEach(link => {
            link.classList.remove('toc-highlight');
        });

        
        if (highlightedHeader) {
            const link = contentHeader.querySelector(`nav#TableOfContents a[href="#${highlightedHeader.id}"]`);
            if (link) {
                link.classList.add('toc-highlight');
            }
        }
    }

    function toggleTOC() {
        const tocContainer = contentHeader.querySelector('#contents-toc');
        const isDisplayed = window.getComputedStyle(tocContainer).display !== 'none';
        tocContainer.style.display = isDisplayed ? 'none' : 'flex';
    }

    function toggleTOCOnScroll() {
        const tocContainer = document.querySelector('#TableOfContents');
        const footerNav = document.querySelector('.footer-nav');

        if (!tocContainer || !footerNav) return;

        const footerNavTop = footerNav.getBoundingClientRect().top;
        const windowHeight = window.innerHeight;

        
        if (footerNavTop <= windowHeight) {
            tocContainer.style.display = 'none';
        } else {
            tocContainer.style.display = 'flex';
        }
    }

    function throttle(func, limit) {
        let lastFunc;
        let lastRan;
        return function () {
            const context = this;
            const args = arguments;
            if (!lastRan) {
                func.apply(context, args);
                lastRan = Date.now();
            } else {
                clearTimeout(lastFunc);
                lastFunc = setTimeout(function () {
                    if ((Date.now() - lastRan) >= limit) {
                        func.apply(context, args);
                        lastRan = Date.now();
                    }
                }, limit - (Date.now() - lastRan));
            }
        }
    }

    function setExternalLinksToOpenInNewTab() {
        const links = document.querySelectorAll('.e-content a[href*="//"]:not(.stream-url):not(.stream-time)');
        const linkDisplay = document.querySelector('.link-display');

        links.forEach(function (link) {
            link.setAttribute('target', '_blank');

            link.addEventListener('mouseover', function () {
                const url = new URL(this.href);
                const rootDomain = url.hostname.replace(/^www\./, '');
                const boldDomain = `<span class="bold-domain">${rootDomain}</span>`;
                const displayUrl = this.href.replace(rootDomain, boldDomain);

                linkDisplay.innerHTML = displayUrl;
                linkDisplay.style.display = 'block';
                const linkRect = this.getBoundingClientRect();
                linkDisplay.style.top = `${linkRect.bottom + window.scrollY}px`;
                linkDisplay.style.left = `${linkRect.left + window.scrollX}px`;
            });

            link.addEventListener('mouseout', function () {
                linkDisplay.style.display = 'none';
            });
        });
    }

    function setupSidenotes() {
    const sidenoteNumbers = mainElement.querySelectorAll('.sidenote-number');

    if (sidenoteNumbers.length >= 3 && window.innerWidth >= 1000) {
        const sidenoteLine = mainElement.querySelectorAll('.sidenote-line');
        sidenoteLine.forEach(element => {
            element.style.border = 'none';
        });

        var jQueryScript = document.createElement('script');
        jQueryScript.src = '/jquery-3.6.0.min.js';
        document.head.appendChild(jQueryScript);

        jQueryScript.onload = function () {
            var jsPlumbScript = document.createElement('script');
            jsPlumbScript.src = '/jsplumb.min.js';
            document.head.appendChild(jsPlumbScript);

            jsPlumbScript.onload = function () {
                initJsPlumb();
            };
        };
    }

    function applySidenoteMargins() {
        const screenWidth = window.innerWidth;

        if (screenWidth <= 1000) {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                const afterSidenoteContent = sidenoteNumber.nextSibling;

                if (sidenoteBox) {
                    if (afterSidenoteContent && afterSidenoteContent.textContent.trim() !== "") {
                        sidenoteBox.style.marginBottom = "0"; 
                    }
                }
            });
        } else {
            sidenoteNumbers.forEach(sidenoteNumber => {
                const sidenoteBox = sidenoteNumber.querySelector('.sidenote-box');
                if (sidenoteBox) {
                    sidenoteBox.style.marginBottom = "";  
                }
            });
        }
    }

    applySidenoteMargins();

    window.addEventListener('resize', applySidenoteMargins);
}


    function initJsPlumb() {
        var jsPlumbCSS = document.createElement('link');
        jsPlumbCSS.href = '/jsplumbtoolkit-defaults.min.css';
        jsPlumbCSS.rel = 'stylesheet';
        document.head.appendChild(jsPlumbCSS);

        jQuery(document).ready(function () {
            jsPlumb.importDefaults({
                ConnectionsDetachable: false,
                ReattachConnections: false,
                Endpoint: "Blank",
                Connector: ["Straight"],
                PaintStyle: { stroke: "var(--text-color)", strokeWidth: 1 }
            });

            createConnections();
            var resizeObserver = new ResizeObserver(function () {
                createConnections();
            });
            resizeObserver.observe(document.body);
        });
    }

    function createConnections() {
        jsPlumb.deleteEveryEndpoint();
        jQuery('.sidenote-number').each(function () {
            var sidenoteNumber = jQuery(this);
            var sidenote = sidenoteNumber.find('.sidenote');

            if (sidenote.length) {
                jsPlumb.connect({
                    source: sidenoteNumber[0],
                    target: sidenote[0],
                    anchors: ["Center", "RightMiddle"],
                    cssClass: "jsplumb-line"
                });
            }
        });
    }


    function preventMultiTouchGestures() {
        window.onload = function () {
            document.addEventListener('touchstart', function (event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, false);
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            document.addEventListener('gesturestart', function (event) {
                event.preventDefault();
            }, false);
        }
    }
</script>

</html>